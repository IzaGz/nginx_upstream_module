<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  </head>

  <body>
    <div class='container' style='margin-top:50px;'>
      <div class="input-group input-group-lg">
        <input type='text' class='form-control' placeholder='{}' aria-describedby='sizing-addon1' id='input'>
        <span class='input-group-btn'>
          <button type='button' class='btn' id='submit'>execute</button>
         </span>
      </div>
      <div>
        <pre id='output'></pre>
      </div>
    </div>

    <script>
      $(document).ready(function() {

        var id = 0;
        var $out = $('#output');

        function render(data) {
          $out.append('<div>[' + data.id + ']' + JSON.stringify(data) + '</div>');
        }

        function render_error(data, stat, xhr) {
          if (data.status &&
              (data.status === 502 || data.status == 500))
          {
            $out.append('<div>tarantool backend failure</div>');
          }
        }

        $("#submit").click(function() {

          try {
            var $input = $('#input');
            var call = JSON.stringify({
              method: 'call',
              params: ['echo', [JSON.parse($input.val())]],
              id: ++id
            });

            $.ajax({ type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    url: 'tnt',
                    data: call,
                    success: render,
                    error: render_error});

          } catch (e) {
            $out.append('<div> Error:' + e + '</div>');
          }
        });

      });
    </script>

  </body>
</html>
